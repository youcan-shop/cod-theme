(function(h,l){typeof exports=="object"&&typeof module<"u"?module.exports=l():typeof define=="function"&&define.amd?define(l):(h=typeof globalThis<"u"?globalThis:h||self,h["youcan-js"]=l())})(this,function(){"use strict";var tt=Object.defineProperty;var at=(h,l,d)=>l in h?tt(h,l,{enumerable:!0,configurable:!0,writable:!0,value:d}):h[l]=d;var i=(h,l,d)=>(at(h,typeof l!="symbol"?l+"":l,d),d);const h=c=>c,l=c=>{window.location.href=`${location.origin}${c}`},d=c=>c.map(a=>{try{return a?new URL(a).origin:void 0}catch{return`${window.location.protocol}//${a}`}}).filter(a=>typeof a<"u")[0];class n extends Error{constructor(a,e,s){super(a);i(this,"status");i(this,"detail");i(this,"meta");this.status=e,this.detail=a,this.meta=s,Object.setPrototypeOf(this,n.prototype)}}const D=async c=>{var t;try{if(!c.headers||((t=c.headers)==null?void 0:t.get("content-type"))!=="application/json")throw new n("The provided data is invalid",600);const a=await c.json();if(c.ok)return a;const e=h(a);throw e.error?new n(e.error||"",-7,[]):new n(e.detail,e.status,e.meta)}catch(a){throw a instanceof TypeError?new n(a.message,0):a instanceof n?a:new n(a.message,-1)}},E=class{constructor(t){i(this,"configs",{csrfToken:"",baseUrl:""});this.configs=t}static init(t){return this.instance===void 0&&t&&(this.instance=new E(t)),this.instance}get(){return this.configs}};let g=E;i(g,"instance");const{get:y,post:p,remove:_}=new class{constructor(){i(this,"request",async(t,a,e,s={isApi:!0})=>{const o=g.init(),u=o==null?void 0:o.get(),A=u==null?void 0:u.csrfToken;let f=u==null?void 0:u.baseUrl;const R={"x-csrf-token":String(A),"x-requested-with":"XMLHttpRequest",...s==null?void 0:s.headers};if(s.isApi&&(f=`${f}/api`),!f||!A)throw new n("Request failed duo to missing configs",-3);let T=e;e instanceof FormData||(R["Content-Type"]="application/json",T=JSON.stringify(e));const Z=await fetch(`${f}${a}`,{method:t,headers:R,body:T});return D(Z)});i(this,"get",(t,a)=>this.request("GET",t,void 0,a));i(this,"post",(t,a,e)=>this.request("POST",t,a,e));i(this,"remove",(t,a,e)=>this.request("DELETE",t,a,e))}},k=async(c,t)=>{const a=s=>Object.entries(s).map(([o,u])=>`${o}=${u}`).join("&");let e="";for(const[s,o]of Object.entries(t))s!=="filters"?e+=`${s}=${o}&`:o.forEach(u=>{e+=`${a(u)}&`});return await y(`${c}?${e}`)},r=async c=>{try{return{ok:!0,data:await c()}}catch(t){return t instanceof n?{ok:!1,data:t}:{ok:!1,data:new n(t.message,-2)}}};class M{async fetch(t){return await r(async()=>await y(`/products/${t}`))}async fetchByCategory(t,a){return await r(async()=>await k(`/categories/${t}/products`,a))}async fetchByVariantId(t){return await r(async()=>await y(`/products/variant/${t}`))}async fetchAll(t){return await r(async()=>await k("/products",t))}async fetchReviews(t,a){return await r(async()=>await k(`/products/${t}/reviews`,a))}async upload(t){const a=new FormData;if(!(typeof t=="string"?JSON.parse(t):t).type.includes("image"))throw new n("The file type is not an image",-6);return a.append("image",t),await r(async()=>await p("/upload/image",a,{isApi:!1}))}async submitReview(t,a){return await r(async()=>await p(`/products/${t}/reviews`,a))}}class C{async fetch(t){return await r(async()=>await y(`/categories/${t}`))}async fetchAll(t){return await r(async()=>await k("/categories",t))}async fetchSubCategories(t,a){return await r(async()=>await k(`/categories/${t}/children`,a))}}class j{async fetch(){return await r(async()=>await y("/cart/content"))}async addItem(t){return await r(async()=>await p("/cart/add",{quantity:t.quantity,attachedImage:t.attachedImage,id:t.productVariantId}))}async removeItem(t){return await r(async()=>await p("/cart/remove",{id:t.cartItemId,productVariantId:t.productVariantId}))}async updateItem(t){return await r(async()=>await p("/cart/update",{quantity:t.quantity,productVariantId:t.productVariantId,id:t.cartItemId}))}async note(t){return await r(async()=>await p("/checkout/notes",{additional_note:t},{isApi:!1}))}}class x{async placeExpressCheckoutOrder(t){const a=new FormData;a.append("id",t.productVariantId),a.append("quantity",String(t.quantity));for(const s in t.fields)a.append(s,t.fields[s]);return await r(async()=>await p("/checkout/express",a))}async applyCoupon(t){return await r(async()=>await p("/checkout/coupons",{coupon:t},{isApi:!1}))}async removeCoupons(){return await r(async()=>await _("/checkout/coupons",void 0,{isApi:!1}))}}class B{async fetch(){return await r(async()=>await y("/menus"))}}let U=class{async contact(t){return await r(async()=>await p("/contact",t))}},V=class{async fetchAll(t){return await r(async()=>await k("/pages",t))}};class P{async answer(t){const a=new FormData;return a.append("answer",t.answer),a.append("order_id",t.order_id),Object.entries(t.product_offers).forEach(([s,o])=>{a.append(`product_offers[${s}]`,o)}),await r(async()=>await p(`/upsells/${t.upsell_id}/answer`,a))}}const{productApi:w,categoryApi:S,cartApi:m,checkoutApi:v,menuApi:F,storeApi:L,pageApi:N,upsellApi:G}={productApi:new M,categoryApi:new C,cartApi:new j,checkoutApi:new x,menuApi:new B,storeApi:new U,pageApi:new V,upsellApi:new P};class b{constructor(t,a,e){i(this,"callback");i(this,"queryOptions");i(this,"meta");this.callback=t,this.queryOptions=a,this.meta=e}async data(){const{data:t}=await this.callback(this.queryOptions);if(t instanceof n)throw t;return this.meta=t.meta,t.data}pagination(){var t,a,e;return(t=this.meta)!=null&&t.pagination?{totalPages:(a=this.meta)==null?void 0:a.pagination.total_pages,currentPage:(e=this.meta)==null?void 0:e.pagination.current_page}:{totalPages:2,currentPage:1}}next(){const{currentPage:t,totalPages:a}=this.pagination();return this.queryOptions.page=t<a?t+1:t,this}prev(){const{currentPage:t}=this.pagination();return this.queryOptions.page=t>1?t-1:t,this}orderBy(t="",a=""){return this.queryOptions.sort_field=t,this.queryOptions.sort_order=a,this}search(t=""){return this.queryOptions.q=t,this}filterBy(t,a,e="="){const s=this.queryOptions.filters||[];return s.push({[`filters[${s.length}][field]`]:t,[`filters[${s.length}][operator]`]:e,[`filters[${s.length}][value]`]:a}),this.queryOptions.filters=s,this}}class H{fetchAll(t={}){const a=async e=>await w.fetchAll(e);return new b(a,t)}async fetchByIdOrSlug(t){const{data:a}=await w.fetch(t);if(a instanceof n)throw a;return a}fetchByCategory(t,a={}){const e=async s=>await w.fetchByCategory(t,s);return new b(e,a)}async fetchByVariantId(t){const{data:a}=await w.fetchByVariantId(t);if(a instanceof n)throw a;return a}fetchReviews(t,a={}){const e=async s=>await w.fetchReviews(t,s);return new b(e,a)}async upload(t){const{data:a}=await w.upload(t);if(a instanceof n)throw a;return a}async submitReview(t,a){const{data:e}=await w.submitReview(t,a);if(e instanceof n)throw e;return e}}class K{async fetch(t){const{data:a}=await S.fetch(t);if(a instanceof n)throw a;return a}fetchAll(t={}){const a=async e=>await S.fetchAll(e);return new b(a,t)}fetchSubCategories(t,a={}){const e=async s=>await S.fetchSubCategories(t,s);return new b(e,a)}}class O{async fetch(){const{data:t}=await m.fetch();if(t instanceof n)throw t;return t}async addItem(t){const{quantity:a,productVariantId:e,attachedImage:s=null}=t,{data:o}=await m.addItem({quantity:a,attachedImage:s,productVariantId:e});if(o instanceof n)throw o;return await this.fetch()}async removeItem(t){const{data:a}=await m.removeItem(t);if(a instanceof n)throw a;return await this.fetch()}async updateItem(t){const{data:a}=await m.updateItem(t);if(a instanceof n)throw a;return await this.fetch()}async note(t){const{data:a}=await m.note(t);if(a instanceof n)throw a}}const $=new O;class J{constructor(t,a){i(this,"data");i(this,"ok");i(this,"ERROR_MESSAGES",{INVALID_DATA:"The given data was invalid.",SKIP_SHIPPING:"cannot skip shipping step",SKIP_PAYMENT:"cannot skip payment step"});this.data=t,this.ok=a}onSuccess(t){return this.ok&&!(this.data instanceof n)&&t(this.data,()=>l("/checkout/thankyou")),this}onValidationErr(t){return this.data instanceof n&&this.data.detail===this.ERROR_MESSAGES.INVALID_DATA&&t(this.data),this}onSkipShippingStep(t){return this.data instanceof n&&this.data.detail===this.ERROR_MESSAGES.SKIP_SHIPPING&&t(this.data,()=>l("/checkout/shipping")),this}onSkipPaymentStep(t){return this.data instanceof n&&this.data.detail===this.ERROR_MESSAGES.SKIP_PAYMENT&&t(this.data,()=>l("/checkout/payment")),this}catch(t){return this.data instanceof n&&!this.ok&&t(this.data),this}finally(t){return t(),this}}class q{async placeExpressCheckoutOrder(t){const{data:a,ok:e}=await v.placeExpressCheckoutOrder(t);return new J(a,e)}async applyCoupon(t){const{data:a}=await v.applyCoupon(t);if(a instanceof n)throw a;return $.fetch()}async removeCoupons(){const{data:t}=await v.removeCoupons();if(t instanceof n)throw t;return $.fetch()}}i(q,"onSuccess");class Q{async fetch(){const{data:t}=await F.fetch();if(t instanceof n)throw t;return t}}class Y{async contact(t){const{data:a}=await L.contact(t);if(a instanceof n)throw a}}class z{fetchAll(t={}){const a=async e=>await N.fetchAll(e);return new b(a,t)}}class X{async answer(t){const{data:a}=await G.answer(t);if(a instanceof n)throw a;return a}}const W={BASE_URL:""};class I{constructor(){i(this,"product");i(this,"category");i(this,"cart");i(this,"checkout");i(this,"menu");i(this,"store");i(this,"page");i(this,"upsell");this.product=new H,this.category=new K,this.cart=new O,this.checkout=new q,this.menu=new Q,this.store=new Y,this.page=new z,this.upsell=new X}static init(){var o,u,A,f;if(typeof window.Dotshop>"u")throw new TypeError("Failed to initialize due to missing store context");const t=(o=window.Dotshop.store)==null?void 0:o.domain,a=(u=window.location)==null?void 0:u.hostname,s=[t!==a&&a!=="seller-area.youcan.shop"?(A=window.location)==null?void 0:A.origin:(f=window.Dotshop.store)==null?void 0:f.domain,W.BASE_URL];return g.init({csrfToken:window.Dotshop.csrfToken,baseUrl:d(s)}),new I}}return window.youcanjs=I.init(),I});
